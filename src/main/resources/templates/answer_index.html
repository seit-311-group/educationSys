<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <title>电路知识问答</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/css/main.css"/>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" />
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/bootstrap.min.js" type="application/javascript"></script>
    <!--引入Vue-->
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<style type="text/css">
    .td{
        height: 10px;
        overflow: hidden;
    }
    #main{
        margin:0 auto;
        width: 1300px;
        height: 640px;
        border: 1px solid black;
    }

    #table_area{
        display: flex;
        justify-content: center;
        margin-top: 5px;
        width: 1300px;
        height: 595px;
        /*border: 1px solid red;*/
    }

    #jump_question{
        cursor: pointer;
    }

    #page_area{
        width: 1300px;
        height: 35px;
        /*border: 1px solid green;*/

    }
    #page{
        float: right;
    }

    #questionTable{
        width: 1100px;
    }


</style>

<body>
    <div th:include="navigation :: nav"></div>
    <div id="main">
        <div id="table_area">
            <table id="questionTable" class="table table-striped table table-hover">
                <thead>
                <tr>
                    <td style="width: 15px"></td>
                    <td style="width: 10px"><strong>#</strong></td>
                    <td style="width: 550px"><strong>题名</strong></td>
                    <td style="width: 70px"><strong>考查知识点</strong></td>
                    <td style="width: 40px"><strong>通过率</strong></td>
                    <td style="width: 31px"><strong>难度</strong></td>
                </tr>
                </thead>
                <tr v-for="(question,index) in allQuestion" >
                    <td><span v-if="showPassedQuestion(index+1)" class="glyphicon glyphicon-ok" style="color: green"></span></td>
                    <td>{{index+1}}</td>
                    <td><a id="jump_question" v-on:click="jump(index)" :name="index">{{question.description}}</a></td>
                    <td>{{question.keyword}}</td>
                    <td >{{question.passrate}}</td>
                    <td ><span :style="{'color': set_color(question.difficulty)}" >{{question.difficulty}}</span></td>
                </tr>
            </table>

        </div>
        <!--<div id="page_area">-->
        <!--    <div id="page">-->
        <!--        <span class="form-inline">-->
        <!--                <select class="form-control" v-model="pagesize" v-on:change="showPage(pageCurrent,$event,true)">-->
        <!--                    <option value="10">10</option>-->
        <!--                    <option value="20">20</option>-->
        <!--                    <option value="30">30</option>-->
        <!--                    <option value="40">40</option>-->
        <!--                </select>-->
        <!--            </span>-->
        <!--        <span v-for="item in pageCount+1">-->
        <!--                <span v-if="item==1" class="btn btn-default" v-on:click="showPage(1,$event)" :class="{'disabled':fDisabled}">-->
        <!--                    首页-->
        <!--                </span>-->
        <!--                <span v-if="item==1" class="btn btn-default" v-on:click="showPage(pageCurrent-1,$event)" :class="{'disabled':fDisabled}">-->
        <!--                    上一页-->
        <!--                </span>-->
        <!--                <span v-if="item==1" class="btn btn-default" v-on:click="showPage(item,$event)">-->
        <!--                    {{item}}-->
        <!--                </span>-->
        <!--                <span v-if="item==1 &amp;&amp;item &lt;showPagesStart-1" class="btn btn-default disabled">-->
        <!--                    ...-->
        <!--                </span>-->
        <!--                <span v-if="item&gt;1 &amp;&amp;item&lt;=pageCount-1 &amp;&amp;item&gt;=showPagesStart &amp;&amp;item&lt;=showPageEnd &amp;&amp;item&lt;=pageCount" class="btn btn-default" v-on:click="showPage(item,$event)">-->
        <!--                    {{item}}-->
        <!--                </span>-->
        <!--                <span v-if="item==pageCount &amp;&amp;item&gt;showPageEnd+1" class="btn btn-default disabled">-->
        <!--                    ...-->
        <!--                </span>-->
        <!--                <span v-if="item==pageCount" class="btn btn-default" v-on:click="showPage(item,$event)"  >-->
        <!--                    {{item}}-->
        <!--                </span>-->
        <!--                <span v-if="item==pageCount" class="btn btn-default" v-on:click="showPage(pageCurrent+1,$event)" :class="{'disabled':lDisabled}">-->
        <!--                    下一页-->
        <!--                </span>-->
        <!--                <span v-if="item==pageCount" class="btn btn-default" v-on:click="showPage(pageCount,$event)" :class="{'disabled':lDisabled}">-->
        <!--                    尾页-->
        <!--                </span>-->
        <!--            </span>-->
        <!--        <span>{{pageCurrent}}/{{pageCount}}</span>-->
        <!--    </div>-->

        <!--</div>-->
    </div>
</body>

<script >
    //<![CDATA[
    const App = {
        data() {
            return {
                allQuestion: [],
                passedQuestion: [],
                passed: true,
                //为第一页或者最后一页时，首页，尾页不能点击
                fDisabled:false,
                lDisabled:false,
                //总项目数
                totalCount: 200,
                //分页数
                pageCount: 20,
                //当前页面
                pageCurrent: 1,
                //分页大小
                pagesize: 10,
                //显示分页按钮数
                showPages: 11,
                //开始显示的分页按钮
                showPagesStart: 1,
                //结束显示的分页按钮
                showPageEnd: 100,
                //分页数据
                arrayData: [],
                url: '',
                domain: ''

            }
        },
        mounted: function () {
            this.url = window.document.URL;
            this.domain = this.url.split(':')[1].substring(2);
            this.send();
            this.loadQuestion();
        },
        methods: {
            async loadQuestion() {
                // 找到学生通过的所有问题
                await axios.get('/student/findAllPassedQuestion',{
                }).then(response=>{
                    let passedQuestions = response.data.toString();
                    this.passedQuestion = passedQuestions.split(',');
                });
                await axios.post('/load', {
                }).then(res => {
                    var arr = res.data;
                    var len = arr.length;
                    for (var i = 0; i < len; i++) {
                        let len = arr[i].description.length;
                        if (arr[i].description.charAt(len-1) != '。'){
                            arr[i].description += '。';
                        }
                        var passrate = arr[i].passrate;
                        let pass = passrate * 100;
                        arr[i].passrate = pass.toString().split(".")[0] + '%';
                        var key = 'difficulty';
                        if (passrate == null) {
                            var value = '无';
                        } else if (passrate < 0.30) {
                            var value = '困难';
                        } else if (passrate >= 0.30 && passrate < 0.6) {
                            var value = '中等';
                        } else {
                            var value = '简单';
                        }
                        arr[i][key] = value;

                    }
                    this.allQuestion = arr;
                    this.showPassedQuestion();
                })
            },
            send(){
                axios.post('getUrl',{url : this.url})
            },
            showPassedQuestion(index) {
                if(this.passedQuestion != null && this.passedQuestion !=''){
                    for (var i = 0; i < this.passedQuestion.length; i++){
                        if (index == this.passedQuestion[i]){
                            return true;
                        }
                    }
                }
                return false;
            },
            set_color(str) {
                if (str == '困难') {
                    return 'red';
                } else if (str == '中等') {
                    return '#c76e01';
                } else if (str == '简单') {
                    return 'green';
                } else {
                    return 'black';
                }
            },
            jump(index) {
                index += 1;
                var url = 'question?id=' + index;
                window.location.href = url;
            },
            showPage(pageIndex, $event, forceRefresh) {

                if (pageIndex > 0) {
                    if (pageIndex > this.pageCount) {
                        pageIndex = this.pageCount;
                    }
                    //判断数据是否需要更新
                    var currentPageCount = Math.ceil(this.totalCount / this.pagesize);
                    if (currentPageCount != this.pageCount) {
                        pageIndex = 1;
                        this.pageCount = currentPageCount;
                    } else if (this.pageCurrent == pageIndex && currentPageCount == this.pageCount && typeof (forceRefresh) == "undefined") {
                        console.log("not refresh");
                        return;
                    }

                    //处理分页点中样式
                    var buttons = $("#pager").find("span");
                    for (var i = 0; i < buttons.length; i++) {
                        if (buttons.eq(i).html() != pageIndex) {
                            buttons.eq(i).removeClass("active");
                        } else {
                            buttons.eq(i).addClass("active");
                        }
                    }

                    //测试数据 随机生成的
                    var newPageInfo = [];
                    var time = new Date();
                    for (var i = 0; i < this.pagesize; i++) {
                        newPageInfo[newPageInfo.length] = {
                            timestamp: time,
                            count: (i + (pageIndex - 1) * 20)
                        };
                    }
                    this.pageCurrent = pageIndex;
                    this.arrayData = newPageInfo;
                    //如果当前页首页或者尾页，则上一页首页就不能点击，下一页尾页就不能点击
                    if (this.pageCurrent === 1) {
                        this.fDisabled = true;
                    } else if (this.pageCurrent === this.pageCount) {
                        this.lDisabled = true;
                    } else {
                        this.fDisabled = false;
                        this.lDisabled = false;
                    }

                    //计算分页按钮数据
                    if (this.pageCount > this.showPages) {
                        if (pageIndex <= (this.showPages - 1) / 2) {
                            this.showPagesStart = 1;
                            this.showPageEnd = this.showPages - 1;
                            console.log("showPage1")
                        } else if (pageIndex >= this.pageCount - (this.showPages - 3) / 2) {
                            this.showPagesStart = this.pageCount - this.showPages + 2;
                            this.showPageEnd = this.pageCount;
                            console.log("showPage2")
                        } else {
                            console.log("showPage3")
                            this.showPagesStart = pageIndex - (this.showPages - 3) / 2;
                            this.showPageEnd = pageIndex + (this.showPages - 3) / 2;
                        }
                    }
                    console.log("showPagesStart:" + this.showPagesStart + ",showPageEnd:" + this.showPageEnd + ",pageIndex:" + pageIndex);
                }
            }
        }
    }

    Vue.createApp(App).mount("#main")

    //]]>
</script>

</html>